================================================================================
TEST COVERAGE GAP ANALYSIS - QUICK REFERENCE
================================================================================

CODEBASE METRICS:
  Total Source Lines:  7,792
  Total Test Lines:    2,252
  Current Coverage:    15-18%
  Test Functions:      165

================================================================================
1. UNTESTED SERVICES (1/6 services)
================================================================================

❌ store_service.py (59 lines) - MEDIUM CRITICALITY
   Classes: StoreService
   Functions: load_store(), save_store(), get_store_service()
   Risk: JSON persistence failures, file I/O errors

✓ All other services tested (collection, deck, image, search)

================================================================================
2. UNTESTED REPOSITORIES (0/3 repositories)
================================================================================

✓ All repositories are fully tested

================================================================================
3. UNTESTED UTILS - CRITICAL GAPS (13/19 files)
================================================================================

TIER 1 - CRITICAL (Immediate Risk):
────────────────────────────────────────────────────────────────────────────

❌ card_data.py (283 lines) - CRITICAL
   Core card data manager with HTTP, caching, ZIP extraction
   Missing: CardDataManager.search_cards(), ensure_latest(), _build_index()
   
❌ card_images.py (707 lines) - CRITICAL  
   Image cache with SQLite, concurrent downloads
   Missing: CardImageCache, BulkImageDownloader, concurrent operations
   
❌ mtggoldfish.py (338 lines) - CRITICAL
   Metagame scraping with complex caching logic
   Missing: get_archetype_stats(), caching, legacy migration, regex parsing

TIER 2 - HIGH (Likely Risk):
────────────────────────────────────────────────────────────────────────────

❌ mtgo_decklists.py (194 lines) - HIGH
   MTGO decklist scraping and HTML parsing
   Missing: _classify_event(), fetch_decklist_index(), regex parsing

❌ mana_icon_factory.py (436 lines) - HIGH
   wxPython graphics rendering with font/CSS loading
   Missing: ManaIconFactory.render(), _get_bitmap(), graphics operations

❌ mtgo_bridge.py (147 lines) - HIGH
   MTGO client integration with payload validation
   Missing: get_collection_snapshot(), accept_pending_trades(), error handling

❌ metagame.py (67 lines) - HIGH
   MTGGoldfish web scraping for player decks
   Missing: get_latest_deck(), HTML parsing, OCR handling

TIER 3 - LOW (Config/Constants):
────────────────────────────────────────────────────────────────────────────

❌ paths.py, game_constants.py, service_config.py, stylize.py, 
   ui_constants.py, paths_constants.py (200 lines combined) - LOW
   Simple config and constants, minimal business logic risk

⚠️  ui_helpers.py (71 lines) - PARTIALLY tested

================================================================================
4. UNTESTED NAVIGATORS / API CLIENTS (2 files, 532 lines)
================================================================================

❌ mtggoldfish.py (338 lines) - See Tier 1 above
❌ mtgo_decklists.py (194 lines) - See Tier 2 above

Both are external data sources with NO test coverage

================================================================================
5. COVERAGE BY CATEGORY
================================================================================

                    Files   LOC    Tests    Coverage
Services              6    1,767    5/6      83%
Repositories          3    1,256    3/3     100%
Utils (Critical)      4    1,350    0/4       0%
Utils (Config)        5      200    0/5       0%
Navigators            2      532    0/2       0%
─────────────────────────────────────────────────────────────
TOTAL                20    5,105   8/20      18%

================================================================================
6. TOP 10 UNTESTED MODULES BY LINES OF CODE
================================================================================

Rank  Module                  LOC    Criticality  Type
────  ──────────────────────  ───    ───────────  ───────────
 1.   card_images.py          707    CRITICAL     Image Cache
 2.   mtggoldfish.py          338    CRITICAL     Web Scraping
 3.   mana_icon_factory.py    436    HIGH         UI Rendering
 4.   card_data.py            283    CRITICAL     Data Manager
 5.   mtgo_decklists.py       194    HIGH         Web Scraping
 6.   mtgo_bridge.py          147    HIGH         Integration
 7.   metagame.py              67    HIGH         Web Scraping
 8.   store_service.py         59    MEDIUM       Persistence
 9.   stylize.py              60    LOW           UI Styling
10.   find_opponent_names.py   10    LOW          Utility

================================================================================
7. CRITICAL UNTESTED FUNCTIONS (BY RISK)
================================================================================

FUNCTION                                LOC  COMPLEXITY  RISK
──────────────────────────────────────  ───  ───────────  ─────────────────
CardDataManager.ensure_latest()          44  VERY HIGH   Data Integrity
CardImageCache.* (all methods)          300+  VERY HIGH  Image Management
get_archetype_stats()                    55  VERY HIGH   Metagame Data
BulkImageDownloader.download_images()   100+  VERY HIGH  Concurrent Ops
ManaIconFactory._get_bitmap()            56  VERY HIGH   UI Rendering
fetch_deck_text()                        18  HIGH        Web Scraping
accept_pending_trades()                  31  HIGH        MTGO Integration
_build_index()                           24  HIGH        Data Transform
_load_deck_cache()                       10  HIGH        File I/O
_classify_event()                        18  MEDIUM      Web Parsing

================================================================================
8. IDENTIFIED PATTERNS WITHOUT TESTS
================================================================================

Pattern                                Count   Total LOC
────────────────────────────────────── ─────   ─────────
HTTP request handling                   5       150
HTML/XML parsing (BeautifulSoup)        4       250
File I/O and JSON serialization         6       200
Database operations (SQLite/Mongo)      3       200
Exception handling and error recovery   7       180
Concurrent/async operations             2       150
Complex string manipulation             4       120
Caching logic with TTL                  4       100
Type conversions and validations        5        80
UI rendering (wxPython)                 1       436

================================================================================
9. INTEGRATION POINTS WITHOUT TESTS
================================================================================

Connection                              Risk Level  Missing Tests
─────────────────────────────────────  ─────────  ─────────────────────────
CardDataManager → MTGJSON API          CRITICAL   HTTP caching, ZIP parsing
CardImageCache → Scryfall CDN          CRITICAL   Concurrent downloads
ManaIconFactory → wxPython              HIGH      Graphics rendering
StoreService → File System              MEDIUM    JSON persistence
MTGGoldfish → HTML scraping             CRITICAL  Selector changes
MTGO Bridge → Process IPC               HIGH      Payload validation
MetagameManager → Cache files           HIGH      Legacy migration

================================================================================
10. RECOMMENDATIONS BY PRIORITY
================================================================================

PRIORITY 1 - WEEK 1 (Write ~300 lines of tests):
  [ ] card_data.py - CardDataManager (CRITICAL)
  [ ] store_service.py - StoreService (MEDIUM)
  [ ] mtgo_bridge.py - Bridge functions (HIGH)

PRIORITY 2 - WEEK 2 (Write ~400 lines of tests):
  [ ] card_images.py - CardImageCache, BulkImageDownloader (CRITICAL)
  [ ] mtggoldfish.py - Caching and scraping (CRITICAL)
  [ ] mtgo_decklists.py - Parsing and classification (HIGH)

PRIORITY 3 - WEEK 3 (Write ~350 lines of tests):
  [ ] mana_icon_factory.py - Rendering and symbol logic (HIGH)
  [ ] metagame.py - get_latest_deck() (HIGH)
  [ ] Improve ui_helpers.py coverage

PRIORITY 4 - ONGOING:
  [ ] Add path resolution tests (paths.py)
  [ ] Add error scenario tests for all critical functions
  [ ] Add integration tests for data pipelines
  [ ] Increase overall coverage to 50%+

================================================================================
END OF SUMMARY
================================================================================
